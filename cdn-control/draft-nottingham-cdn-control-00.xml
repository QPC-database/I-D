<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.3.3 -->

<!DOCTYPE rfc SYSTEM "../Tools/rfcbootstrap/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-nottingham-cdn-control-00" category="info">

  <front>
    <title abbrev="CDN-Control">The CDN-Control HTTP Response Header Field</title>

    <author initials="M." surname="Nottingham" fullname="Mark Nottingham">
      <organization>Fastly</organization>
      <address>
        <postal>
          <street>made in</street>
          <city>Prahran</city>
          <region>VIC</region>
          <country>Australia</country>
        </postal>
        <email>mnot@mnot.net</email>
        <uri>https://www.mnot.net/</uri>
      </address>
    </author>

    <date />

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>this specification defines a HTTP header field that conveys HTTP cache directives to gateway caches.</t>



    </abstract>


    <note title="Note to Readers">


<t><spanx style="emph">RFC EDITOR: please remove this section before publication</spanx></t>

<t>The issues list for this draft can be found at <eref target="https://github.com/mnot/I-D/labels/cdn-control">https://github.com/mnot/I-D/labels/cdn-control</eref>.</t>

<t>The most recent (often, unpublished) draft is at <eref target="https://mnot.github.io/I-D/cdn-control/">https://mnot.github.io/I-D/cdn-control/</eref>.</t>

<t>Recent changes are listed at <eref target="https://github.com/mnot/I-D/commits/gh-pages/cdn-control">https://github.com/mnot/I-D/commits/gh-pages/cdn-control</eref>.</t>

<t>See also the draft’s current status in the IETF datatracker, at
<eref target="https://datatracker.ietf.org/doc/draft-nottingham-cdn-control/">https://datatracker.ietf.org/doc/draft-nottingham-cdn-control/</eref>.</t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>Many HTTP origins servers use gateway caches to distribute their content, either locally (sometimes called a “reverse proxy cache”) or in a distributed fashion (“Content Delivery Networks”).</t>

<t>While HTTP defines Cache-Control as a means of controlling cache behaviour, it is often desirable to give gateway caches different instructions. To meet this need, this specification defines a separate header field that conveys HTTP cache directives to gateway caches.</t>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as
described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all capitals, as
shown here.</t>

</section>
</section>
<section anchor="the-cdn-control-response-header-field" title="The CDN-Control Response Header Field">

<t>The CDN-Control Response Header Field allows origin servers to control the behaviour of gateway caches interposed between them and clients, separately from other caches that might handle the response.</t>

<t>It is a Dictionary Structured Header <xref target="I-D.ietf-httpbis-header-structure"/>, whose members can be any directive registered in the HTTP Cache Directive Registry <eref target="https://www.iana.org/assignments/http-cache-directives/http-cache-directives.xhtml">https://www.iana.org/assignments/http-cache-directives/http-cache-directives.xhtml</eref>.</t>

<t>When CDN-Control is present in a response, caches that use it MUST behave as if the Cache-Control and Expires header fields were not present in the response. In other words, CDN-Control “turns off” other cache directives, and is a wholly separate way to control the cache. Note that this is on a response-by-response basis; if CDN-Control is not present, caches fall back to other control mechanisms as required by HTTP <xref target="I-D.ietf-httpbis-cache"/>.</t>

<t>Caches that use CDN-Control MUST implement the semantics of the following directives:</t>

<t><list style="symbols">
  <t>max-age</t>
  <t>must-revalidate</t>
  <t>no-store</t>
  <t>no-cache</t>
  <t>private</t>
</list></t>

<t>Precedence of directies in CDN-Control is the same as in Cache-Control; in particular, no-store and no-cache make max-age inoperative.</t>

<t>Typically, caches that use CDN-CONTROL will remove the header field from a response before forwarding it, but MAY leave it intact (e.g., if the downstream client is known to be using its value).</t>

<section anchor="examples" title="Examples">

<t>For example, the following header fields would instruct a gateway cache to consider the response fresh for 600 seconds, other shared caches for 120 seconds and any remaining caches for 60 seconds:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: max-age=60, smax-age=120
CDN-Control: 600
]]></artwork></figure>

<t>These header fields would instruct a gateway cache to consider the response fresh for 600 seconds, while all other caches would be prevented from storing it:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: no-store
CDN-Control: max-age=600
]]></artwork></figure>

<t>Because CDN-Control is not present, this header field would prevent all caches from storing the response:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: no-store
]]></artwork></figure>

<t>Whereas these would prevent all caches except for gateway caches from storing the response:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: no-store
CDN-Control: none
]]></artwork></figure>

<t>(note that ‘none’ is not a registered cache directive; it is here to avoid sending a header field with an empty value, because such a header might not be preserved in all cases)</t>

</section>
<section anchor="parsing" title="Parsing">

<t>CDN-Control is specified a a Structured Field <xref target="I-D.ietf-httpbis-header-structure"/>, and implementations are encouraged to use a parser for that format in the interests of robustness, interoperability and security.</t>

<t>However, some implementers might initially reuse a Cache-Control parser for simplicity. If they do so, they SHOULD observe the following points, to aid in a smooth transition to a full Structured Field parser and prevent interoperability issues:</t>

<t><list style="symbols">
  <t>If a directive is repeated in the field value (e.g., “max-age=30, max-age=60”), the last value ‘wins’ (60, in this case)</t>
  <t>Members of the list can have parameters (e.g., “max-age=30;a=b;c=d”), which should be ignored by default</t>
</list></t>

<t>When an implementation does parse CDN-Control as a Structured Field, each directive will be assigned value; for example, max-age has an Integer value, no-store’s value is Boolean true, and no-cache’s value can either be Boolean true or contain a list of field names. Implementations SHOULD NOT accept other values (e.g. coerce a max-age with a Decimal value into an Integer). Likewise, implementations SHOULD ignore parameters on directives, unless otherwise specified.</t>

</section>
</section>
<section anchor="security-considerations" title="Security Considerations">

<t>The security considerations of HTTP caching <xref target="I-D.ietf-httpbis-cache"/> apply.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor="RFC2119" target='https://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor="RFC8174" target='https://www.rfc-editor.org/info/rfc8174'>
<front>
<title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
<author initials='B.' surname='Leiba' fullname='B. Leiba'><organization /></author>
<date year='2017' month='May' />
<abstract><t>RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='8174'/>
<seriesInfo name='DOI' value='10.17487/RFC8174'/>
</reference>



<reference anchor="I-D.ietf-httpbis-header-structure">
<front>
<title>Structured Field Values for HTTP</title>

<author initials='M' surname='Nottingham' fullname='Mark Nottingham'>
    <organization />
</author>

<author initials='P' surname='Kamp' fullname='Poul-Henning Kamp'>
    <organization />
</author>

<date month='June' day='3' year='2020' />

<abstract><t>This document describes a set of data types and associated algorithms that are intended to make it easier and safer to define and handle HTTP header and trailer fields, known as "Structured Fields", "Structured Headers", or "Structured Trailers".  It is intended for use by specifications of new HTTP fields that wish to use a common syntax that is more restrictive than traditional HTTP field values.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-httpbis-header-structure-19' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-httpbis-header-structure-19.txt' />
</reference>



<reference anchor="I-D.ietf-httpbis-cache">
<front>
<title>HTTP Caching</title>

<author initials='R' surname='Fielding' fullname='Roy Fielding'>
    <organization />
</author>

<author initials='M' surname='Nottingham' fullname='Mark Nottingham'>
    <organization />
</author>

<author initials='J' surname='Reschke' fullname='Julian Reschke'>
    <organization />
</author>

<date month='July' day='12' year='2020' />

<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless application- level protocol for distributed, collaborative, hypertext information systems.  This document defines HTTP caches and the associated header fields that control cache behavior or indicate cacheable response messages.  This document obsoletes RFC 7234.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-httpbis-cache-10' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-httpbis-cache-10.txt' />
</reference>




    </references>



<section anchor="frequently-asked-questions" title="Frequently Asked Questions">

<section anchor="why-not-surrogate-control" title="Why not Surrogate-Control?">

<t>The Surrogate-Control header field is used by a variety of cache implementations, but their interpretation of it is not consistent; some only support ‘no-store’, others support a few directives, and still more support a larger variety of implementation-specific directives. These implementations also differ in how they relate Surrogate-Control to Cache-Control and other mechanisms.</t>

<t>Rather than attempt to align all of these different behaviours (which would likely fail, because may existing deployments depend upon them) or define a very small subset, a new header field seems more likely to provide good functionality and interoperability.</t>

</section>
<section anchor="why-not-mix-with-cache-control" title="Why not mix with Cache-Control?">

<t>An alternative design would be to have gateway caches combine the directives found in Cache-Control and CDN-Control, considering their union as the directives that must be followed.</t>

<t>While this would be slightly less verbose in some cases, it would make interoperability considerable more complex to achieve. Consider the case when there are syntax errors in the argument of a directive; e.g., ‘max-age=n60’. Should that directive be ignored, or does it invalidate the entire header field value? If the directive is ignored in CDN-Control, should the cache fall back to a value in Cache-Control? And so on.</t>

<t>Also, this approach would make it difficult to direct the gateway cache to store something while directing other caches to avoid storing it (because no-store overrides max-age).</t>

</section>
<section anchor="is-this-just-for-cdns" title="Is this just for CDNs?">

<t>No; any gateway cache can use it. The name is chosen for convenience and brevity.</t>

</section>
</section>


  </back>

<!-- ##markdown-source:
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

-->

</rfc>

