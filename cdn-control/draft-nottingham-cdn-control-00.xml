<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.3.3 -->

<!DOCTYPE rfc SYSTEM "../Tools/rfcbootstrap/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-nottingham-cdn-control-00" category="info">

  <front>
    <title abbrev="CDN-Control">The CDN-Control HTTP Response Header Field</title>

    <author initials="M." surname="Nottingham" fullname="Mark Nottingham">
      <organization>Fastly</organization>
      <address>
        <postal>
          <street>made in</street>
          <city>Prahran</city>
          <region>VIC</region>
          <country>Australia</country>
        </postal>
        <email>mnot@mnot.net</email>
        <uri>https://www.mnot.net/</uri>
      </address>
    </author>

    <date />

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This specification defines a HTTP header field that conveys HTTP cache directives to gateway caches.</t>



    </abstract>


    <note title="Note to Readers">


<t><spanx style="emph">RFC EDITOR: please remove this section before publication</spanx></t>

<t>The issues list for this draft can be found at <eref target="https://github.com/mnot/I-D/labels/cdn-control">https://github.com/mnot/I-D/labels/cdn-control</eref>.</t>

<t>The most recent (often, unpublished) draft is at <eref target="https://mnot.github.io/I-D/cdn-control/">https://mnot.github.io/I-D/cdn-control/</eref>.</t>

<t>Recent changes are listed at <eref target="https://github.com/mnot/I-D/commits/gh-pages/cdn-control">https://github.com/mnot/I-D/commits/gh-pages/cdn-control</eref>.</t>

<t>See also the draft’s current status in the IETF datatracker, at
<eref target="https://datatracker.ietf.org/doc/draft-nottingham-cdn-control/">https://datatracker.ietf.org/doc/draft-nottingham-cdn-control/</eref>.</t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>Many HTTP origins servers use gateway caches to distribute their content, either locally (sometimes called a “reverse proxy cache”) or in a distributed fashion (“Content Delivery Networks”).</t>

<t>While HTTP defines Cache-Control as a means of controlling cache behaviour, it is often desirable to give gateway caches different instructions. To meet this need, this specification defines a separate header field that conveys HTTP cache directives to gateway caches.</t>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as
described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all capitals, as
shown here.</t>

</section>
</section>
<section anchor="the-cdn-control-response-header-field" title="The CDN-Control Response Header Field">

<t>The CDN-Control Response Header Field allows origin servers to control the behaviour of gateway caches interposed between them and clients, separately from other caches that might handle the response.</t>

<t>It is a Dictionary Structured Header <xref target="I-D.ietf-httpbis-header-structure"/>, whose members can be any directive registered in the HTTP Cache Directive Registry <eref target="https://www.iana.org/assignments/http-cache-directives/http-cache-directives.xhtml">https://www.iana.org/assignments/http-cache-directives/http-cache-directives.xhtml</eref>.</t>

<t>When CDN-Control is present in a response, caches that use it MUST behave as if the Cache-Control and Expires header fields were not present in the response. In other words, CDN-Control “turns off” other cache directives, and is a wholly separate way to control the cache. Note that this is on a response-by-response basis; if CDN-Control is not present, caches fall back to other control mechanisms as required by HTTP <xref target="I-D.ietf-httpbis-cache"/>.</t>

<t>Caches that use CDN-Control MUST implement the semantics of the following directives:</t>

<t><list style="symbols">
  <t>max-age</t>
  <t>must-revalidate</t>
  <t>no-store</t>
  <t>no-cache</t>
  <t>private</t>
</list></t>

<t>Precedence of directies in CDN-Control is the same as in Cache-Control; in particular, no-store and no-cache make max-age inoperative.</t>

<t>Typically, caches that use CDN-CONTROL will remove the header field from a response before forwarding it, but MAY leave it intact (e.g., if the downstream client is known to be using its value).</t>

<section anchor="examples" title="Examples">

<t>For example, the following header fields would instruct a gateway cache to consider the response fresh for 600 seconds, other shared caches for 120 seconds and any remaining caches for 60 seconds:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: max-age=60, smax-age=120
CDN-Control: 600
]]></artwork></figure>

<t>These header fields would instruct a gateway cache to consider the response fresh for 600 seconds, while all other caches would be prevented from storing it:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: no-store
CDN-Control: max-age=600
]]></artwork></figure>

<t>Because CDN-Control is not present, this header field would prevent all caches from storing the response:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: no-store
]]></artwork></figure>

<t>Whereas these would prevent all caches except for gateway caches from storing the response:</t>

<figure><artwork type="example"><![CDATA[
Cache-Control: no-store
CDN-Control: none
]]></artwork></figure>

<t>(note that ‘none’ is not a registered cache directive; it is here to avoid sending a header field with an empty value, because such a header might not be preserved in all cases)</t>

</section>
<section anchor="parsing" title="Parsing">

<t>CDN-Control is specified a a Structured Field <xref target="I-D.ietf-httpbis-header-structure"/>, and implementations are encouraged to use a parser for that format in the interests of robustness, interoperability and security.</t>

<t>However, some implementers might initially reuse a Cache-Control parser for simplicity. If they do so, they SHOULD observe the following points, to aid in a smooth transition to a full Structured Field parser and prevent interoperability issues:</t>

<t><list style="symbols">
  <t>If a directive is repeated in the field value (e.g., “max-age=30, max-age=60”), the last value ‘wins’ (60, in this case)</t>
  <t>Members of the list can have parameters (e.g., “max-age=30;a=b;c=d”), which should be ignored by default</t>
</list></t>

<t>When an implementation does parse CDN-Control as a Structured Field, each directive will be assigned value; for example, max-age has an Integer value, no-store’s value is Boolean true, and no-cache’s value can either be Boolean true or contain a list of field names. Implementations SHOULD NOT accept other values (e.g. coerce a max-age with a Decimal value into an Integer). Likewise, implementations SHOULD ignore parameters on directives, unless otherwise specified.</t>

</section>
</section>
<section anchor="security-considerations" title="Security Considerations">

<t>The security considerations of HTTP caching <xref target="I-D.ietf-httpbis-cache"/> apply.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor="RFC2119" target='https://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor="RFC8174" target='https://www.rfc-editor.org/info/rfc8174'>
<front>
<title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
<author initials='B.' surname='Leiba' fullname='B. Leiba'><organization /></author>
<date year='2017' month='May' />
<abstract><t>RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='8174'/>
<seriesInfo name='DOI' value='10.17487/RFC8174'/>
</reference>



<reference anchor="I-D.ietf-httpbis-header-structure">
<front>
<title>Structured Field Values for HTTP</title>

<author initials='M' surname='Nottingham' fullname='Mark Nottingham'>
    <organization />
</author>

<author initials='P' surname='Kamp' fullname='Poul-Henning Kamp'>
    <organization />
</author>

<date month='June' day='3' year='2020' />

<abstract><t>This document describes a set of data types and associated algorithms that are intended to make it easier and safer to define and handle HTTP header and trailer fields, known as "Structured Fields", "Structured Headers", or "Structured Trailers".  It is intended for use by specifications of new HTTP fields that wish to use a common syntax that is more restrictive than traditional HTTP field values.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-httpbis-header-structure-19' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-httpbis-header-structure-19.txt' />
</reference>



<reference anchor="I-D.ietf-httpbis-cache">
<front>
<title>HTTP Caching</title>

<author initials='R' surname='Fielding' fullname='Roy Fielding'>
    <organization />
</author>

<author initials='M' surname='Nottingham' fullname='Mark Nottingham'>
    <organization />
</author>

<author initials='J' surname='Reschke' fullname='Julian Reschke'>
    <organization />
</author>

<date month='July' day='12' year='2020' />

<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless application- level protocol for distributed, collaborative, hypertext information systems.  This document defines HTTP caches and the associated header fields that control cache behavior or indicate cacheable response messages.  This document obsoletes RFC 7234.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-httpbis-cache-10' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-httpbis-cache-10.txt' />
</reference>




    </references>



<section anchor="frequently-asked-questions" title="Frequently Asked Questions">

<section anchor="why-not-surrogate-control" title="Why not Surrogate-Control?">

<t>The Surrogate-Control header field is used by a variety of cache implementations, but their interpretation of it is not consistent; some only support ‘no-store’, others support a few directives, and still more support a larger variety of implementation-specific directives. These implementations also differ in how they relate Surrogate-Control to Cache-Control and other mechanisms.</t>

<t>Rather than attempt to align all of these different behaviours (which would likely fail, because may existing deployments depend upon them) or define a very small subset, a new header field seems more likely to provide good functionality and interoperability.</t>

</section>
<section anchor="why-not-mix-with-cache-control" title="Why not mix with Cache-Control?">

<t>An alternative design would be to have gateway caches combine the directives found in Cache-Control and CDN-Control, considering their union as the directives that must be followed.</t>

<t>While this would be slightly less verbose in some cases, it would make interoperability considerable more complex to achieve. Consider the case when there are syntax errors in the argument of a directive; e.g., ‘max-age=n60’. Should that directive be ignored, or does it invalidate the entire header field value? If the directive is ignored in CDN-Control, should the cache fall back to a value in Cache-Control? And so on.</t>

<t>Also, this approach would make it difficult to direct the gateway cache to store something while directing other caches to avoid storing it (because no-store overrides max-age).</t>

</section>
<section anchor="is-this-just-for-cdns" title="Is this just for CDNs?">

<t>No; any gateway cache can use it. The name is chosen for convenience and brevity.</t>

</section>
</section>


  </back>

<!-- ##markdown-source:
H4sIAKJ+K18AA7VZa1PkxhX9rl/RwR8A18zAblybeLDjYGCzVC2wBpytVCrl
akk9ozaSWuluMUy28G/PubdbGknYjquS+MNao0ff17nnPpjP54nXvlRLcV8o
cXZ+PT8ztbemFO/u7z+IW+UaUzsl3imZKyvealXmiUxTqx6Xw9eT3GS1rHBO
buXKz2vjva7XhazmWV7Ps/DW/Pg4yaXHW5+ubz4+Jxmu18Zul0LXK5MkurFL
4W3r/Ovj4y+PXyfSKrkUf1G1srJMNsY+rK1pm2XyoLb4lS/FZe2VrZWfn5Pc
JHFe1vkPsjQ1pGyVSxq9FH/3JpsJ/KPrXNV+Jpyx3qqVw9W2ihfe6gyPMlM1
Ml5UeBmPdF3qWv0jSWTrC2OXiZgnAv/p2i3F1UJc98by7eCHK2kfpk+MXcta
/0t6beqleCudL7f8AMKV8ktRwcs4lu9l2sMxH6wsrAx3rFrzh3+9PAtvmBZu
xUun8BgcpCXfVpXUJc5CDP5M/yzgHn7QWvii8L5xy6OjzWaz6J4eJUltbAW9
HhWsE7dvz16/evXlEhFBXPoHSTKfz4VMSVgGX98X2gnXqEyvdMZGiVyt4Con
ZMBPEWCzItgIX0gPnetHtXXhcSYzoC7XVmUkwSFEYg1MbOQ2PHOLIBN6qh+u
6R9vfrjlQ12SfA49xcX55f3N7VI0pZIAqlWVeVSQRarRsVAqVTBCiaZNy6jn
56Q8PO1cC6mldl7glfAVAxji6TvcbetcQO+vOr+ttS/adAF0HJH7ji7n50el
TFXpjgZI/9MiSKgMjoZ5AJI4MCuv6ploa9bEFSo/jNIgdiiD4xIFacMiBmcf
0eG34cyskPWa/A37yAz1n5UlXGvvjtbFvJH4dqr2nVJCls7AGyqot+9E1lpL
8pBevnWAKD+9vLh/K5DQkgDxoOwMwpNe+ODBQiu/WgD+R+CJo1+jCDaOQl7p
PC9VknxGKW5N3nIsk+RK1tuAHmP1GimIMNtH4EG0CP8YPYSnXFNmp60nUCht
CYGeSUDBOQBnaTJZlltx4EylvK7wGd0gT4o98ByOBnaseYqn7h1CMnlADs7O
xUq6gsB2sHcWBIhzVQLUdiuulSfqcnuHsO1joUsVDOiS5YyO7YlXUvZUSsIy
sxLRLSCgdUyXVBXyUZsW3taMHIYVDnPayhRnUxJB8NQXuV6tFAcRTgPJsj/d
QtwbSFM+gL9WKp/F7PmFxHaqkRZH/0+S+7PPiCNZhCzFGX1fs14hfUDzgnje
ib2r7+/u92bh/+L6hq9vL777/vL24pyu796dvn/fX3Rv3L27+f79+e4q3E/w
5dnN1dXF9Xn4GHfF5NbV6d/wPxQTsXfz4f7y5vr0/V7APXGEyVoqDpx3sCsl
1kYhaqziFHQJwpEBGviBb749+yBefSE+ffpdZNbn5/jjj6/+8AV+bAoiBhJm
akAx/AQ6t0I2jZIBbmUJvzXaIzlnJMIVZlMjClbBkZQo0xL+89U7+U2vkTiz
cTHJ+hyDrRGRTAA9FgmqE7wFhxgHF6RIAKWYMyq2Mit1KK0dmGD0yppKGE7J
LnsJU5VeF16A5vKSMxhsGtSF0ZeBOcW5ZjBL5NodI7u1kBrNgaNBe8xAc6Km
VLt5gO7cdS8/P8/gdOiKVKhSMjTyP5FND2EuwOBYG6JKyjDSOX+hRPfaLb8G
Zb4aFlsta8kUKJ3T65p7iyN6Yc7mzneZ8vN3F0+Fr5ihPwIeowjCCUCeC7kN
f3Qumo08SfwIxuAE4sAp4hq9YkMmHIQYXTw1kO1Gae7EBtZTOR4KHEUFdB2j
yIk7Gym6B2czr632hqEesETIAo4qAkK83PMNYWuCP/6aGzAVbOTsJE4cumGe
bufdtUil0+6EzJ54cGBU77cVJV2KEkaCo8Lxi0pR7dWucuRFq/7ZasJFGovT
z6GOD31+RgTPJmEZqsLx0RX6GWYYMtOhpQMtZlwR6MbKUHZSTdh5Dv3Z52gg
n+Yo6nSFnhBWP6ItpJYbd2oDwKMRCpesDC4bqx/pefKB2hS0x5kiKfFczuOp
p1glNLkMn3oMnRO6g4BB27aUqFGdVI5rJxd6PqhOWXxhGjT4ZAW1TdtGc0V+
iV7W4+b6/vbmvdhohKbv9ibViLlkB4CuA8Q/G2lz8ptGkFG4BWheoHN85NQA
ZaGxFQdqsV7MuszIwbLUn8sq0ha54KEm7g3M37pwoBNwdqsOQ1m7eJIUQxSy
t2gXVPg1m0RvklumLfO+OkP/EaNG7DtNXwxTDtYqV3AD++b4mLpeU1PiBby6
QhIuO0DjpVev+5c4KMRxloaGum8yXDytew/Y+umnnzorklHEl10cv35zDELv
fkBKMsDNknSjQ7j+OPX/NX3DTRYl76igBCkptXOKGg0VkUIADTH8dUP7DBoZ
tjM/GvityuQ0q6cEw0Q1wmxQLmoWq30IxVDFofW/UVnW6SP1CZJzF5r9oiz1
lKkmDEOTcv7fajFyWY3xPOh1UPfcvU939ztPyWG1nVSJk9j5kk2EDflodI7o
15zacuJXtPnAOMbixm9DiiL1Y4hcmxW7D0KvQdIDRrjryXfNl1PuMOHs/iAt
ZX2STGIcm2YeHuSwGQlN1W/tRbgGdiWAu+Mw4oGd0WwBbDmZTQZIIltHxvL8
Kjl2GNi7usxdmHKeS4c1KaoC2nheauAB826qSw3PkEwkUGvxAxT2zmxo9qFd
CZi+V4Z6o+Am0IXXPDlZFTQZ9xADvRx9rmmhgfZgFRrb3ODk2OTG3tyk7PAJ
RzZGc6tIcdYhGGAZg8QWmC5BCjyf0FOxahGmF06PipB9HeJfGB82AVxCoaAc
9Hyaijt6cL9r+gKuGEldrdjrSOD34MAdIewdBsYvpfPxg30Y5fbFAZFlN04Q
sg4h+io2n7HK816CGlHu1agLwoBKz18KPZFfpyfZ1zkJBPkB1JgOItmh2TSx
NcEUJ9vSxxYSJ49BhqAg09lfI/LikXTqVwzQiPfAU1yRqWfm/lZFD50wAvr6
19X8gs6seX23RnBiWnZssR9rKXn/W2NQoGvaC6rZqIvo3yIfxWke8ocf0KhO
HZtk2LBD4dwQQNrTYf69nOTZblAUMmM2DDWERUXf40xlM8J8Z09gGcz8ma4w
yUbta4Jlb+XhQrzXD2qjqTOfpncUG4I1DDaFZdAetzWaChd0opN2lLPgIfAu
pjAN01ww5WCe7vK7r6ZROHzSz+yUc7/SvdJEWhJB8JaGemOS+pYaYBgDNjh1
D4j9d/BVFAy6/FhsmVbvWmsNFZYOWt8EvV7cH1O45uUOI1jCtRZ6bXk5wmVh
4snQ14VdTz+UB3jjk1A4SBd2gaNNzUngOB69Xds0xnIxilCMjZTrH4Fn1ObF
yAJrAf+Kgrd7ER1wQHev8ljZebdkGRy3EKFBesH/tJMLSxwiDgz/gTytKmk6
eulCYO/lVBewvBteaJUo+R6KB3LEe6qTTKclsBh6qFVsG3YrpH7wR0IEvgkt
RQl80ywvdbkrshW6CPUEX/PAoprSbHn6pWvUbNE2JuwGeLMWNk0UaNqdoZ+E
Bq5FaUDXJEUN14+w4ZTCCMZ+j8Khe2PNI+At1sagxWvrsB7oy9yU/hcjkFb6
KaTzyHtA6im5g/7cwKMKb9zgob6phFwm6knjlJkqJYP8eBsWNsvT8YnVG1Dv
rM/U2HYB1G1NWA693Gi/xusSFPiwuKb6yaQQNo5caHpdXUk1HM5iMoGnU1p+
0KKHMoE7HV4vhg94WntRM3sOoaUjB4D+dlKqJ0YPiAS1dtHTUJzXqfkswiqI
ZkLKli0g/iQU4Gv7zTLyJizYzKgan4hQ+fa7yle/Od5fiLtQ69gBu3q0K30z
xhXVNh7yupmYJdG+0U7GR2bvb2KrMu4FumI6nopnXbntlxLj1YHsC8IEVOKU
qMOAexCo0zJ0RLT9aABh2adVCIDnBKTB2ofNNunFIl9MS2Hk5o02E3oYiKIl
+D3es/UddD8HiYMuefv5HYO2tYik62peHHQvXVD5xzb+FQV+cciWa3PCo+VY
NyrVYRHFPMdFmPya0fat5u95i1xr3kRQOtAfG0OS/hv+jrWcrxwAAA==

-->

</rfc>

